{% extends "base.html" %}

{% load static %}
{% load crispy_forms_tags %}
{% block head %}
        <link rel="stylesheet" type="text/css" href="{% static 'helper/users.css' %}">
        <script>
            $(function(){
                $('#order-select').change(function(){
                    $('#order-form').submit();
                });
            });
        </script>
        {% load helper_extras %}
{% endblock %}
{% block content %}
        {% load widget_tweaks %}

        {% include "helper/navigation.html" %}

        <div class="tile">
            <div class="row visited-users-div">
                {% for user in visited_users %}
                    <a class="btn btn-info btn-visit" href="{% url 'helper:user_towns' user.id %}">{{user.user_name}}</a>
                {% endfor %}
            </div>
        </div>

        <div class="tile">
            <div style="width: 100%; display: flex;">
                <form action="{% url 'helper:users'%}" method="get">
                    {% csrf_token %}
                    <!--{{ my_filter.form|crispy }}-->
                    <div class="form-group inline-form-group">
                        {{ my_filter.form.user_name.label }}
                        {{ my_filter.form.user_name }}
                    </div>

                    <div class="form-group inline-form-group">
                        {{ my_filter.form.alliance.label }}
                        {{ my_filter.form.alliance }}
                    </div>

                    <div class="form-group inline-form-group">
                        {{ my_filter.form.user_status.label }}
                        {{ my_filter.form.user_status }}
                    </div>

                    <div class="form-group inline-form-group">
                        {{ my_filter.form.order_by.label }}
                        {{ my_filter.form.order_by }}
                    </div>

                    <div class="form-group">
                        <button class="btn btn-success btn-action" type="submit">Zastosuj</button>
                    </div>

                </form>
            </div>
        </div>

        <div class="page-div">
            <div>
                {% if buttons %}
                {% for button in buttons %}
                    <a href="{% url 'helper:users' %}?page={{button.1}}&user_name={{user_name}}&alliance={{alliance}}&user_status={{user_status}}&order_by={{order_by}}" class="btn btn-success  {% if button.1 == page_num %} disabled {% endif %}">{{button.0}}</a>
                {% endfor %}

                {% else %}
                <h5>Nie znaleziono graczy</h5>
                {% endif %}
            </div>
        </div>

        <div class="users-div">
            {% if users_list %}
                <table class="table">
                    <tr>
                        <th>#</th>
                        <th>Nazwa</th>
                        <th>Całkowity wynik</th>
                        <th>Mistrzowie budowy</th>
                        <th>Poziomy budynków</th>
                        <th>Naukowcy</th>
                        <th>Poziomy badań</th>
                        <th>Generałowie</th>
                        <th>Złoto</th>
                        <th>Punkty ofensywy</th>
                        <th>Punkty obrony</th>
                        <th>Handlarz</th>
                        <th>Surowce</th>
                        <th>Datki</th>
                        <th>Punkty Abordażu</th>
                    </tr>
                    {% for user in users_list %}
                        <tr class="{% ifequal user.user_status.id 2 %} inactive-player {% endifequal%} {% ifequal user.user_status.id 3 %} deleted-player {% endifequal%}">
                            <td>{{forloop.counter|get_pos:page_num }}</td>
                            <td><a class="player-a" href="{% url 'helper:user_towns' user.id %}">
                                {% if user.user_status.id == 4 %}
                                    <img src="{% static "helper/icons/vacation_icon.png" %}" alt="something" width="16px" height="16" >
                                {% endif %}
                                {{ user.user_name }}
                                {% if user.alliance %}
                                    [{{user.alliance}}]
                                {% endif %}
                            </a></td>
                            <td>{{user.score|number_commas}}</td>
                            <td>{{user.master_builders|number_commas}}</td>
                            <td>{{user.building_levels|number_commas}}</td>
                            <td>{{user.scientists|number_commas}}</td>
                            <td>{{user.research_level|number_commas}}</td>
                            <td>{{user.generals|number_commas}}</td>
                            <td>{{user.gold|number_commas}}</td>
                            <td>{{user.offensive|number_commas}}</td>
                            <td>{{user.defensive|number_commas}}</td>
                            <td>{{user.trading|number_commas}}</td>
                            <td>{{user.resources|number_commas}}</td>
                            <td>{{user.donations|number_commas}}</td>
                            <td>{{user.piracy|number_commas}}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
{% endblock %}