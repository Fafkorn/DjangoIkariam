{% extends "base.html" %}

{% load static %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'helper/statistics/statistics_alliances.css' %}">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script type="text/javascript">
       var colors = [
            "rgba(255, 255, 255, 1)",
            "rgba(119, 119, 119, 1)",
            "rgba(50, 200, 50, 1)",
            "rgba(200, 50, 50, 1)",
            "rgba(81, 205, 160, 1)",
            "rgba(223, 121, 112, 1)",
            "rgba(76, 156, 160, 1)",
            "rgba(174, 125, 153, 1)",
            "rgba(201, 212, 92, 1)"
        ];
        var backgroundColors = [
            "rgba(255, 255, 255, 0.05)",
            "rgba(119, 119, 119, 0.05)",
            "rgba(50, 200, 50, 0.05)",
            "rgba(200, 50, 50, 0.05)",
            "rgba(81, 205, 160, 0.05)",
            "rgba(223, 121, 112, 0.05)",
            "rgba(76, 156, 160, 0.05)",
            "rgba(174, 125, 153, 0.05)",
            "rgba(201, 212, 92, 0.05)"
        ];

        window.onload = function script() {
            var alliances_config = {
                type: 'line',
                data: {
                    datasets:
                    [
                        {% for alliance in alliance_histories %}
                        {
                            data: [{% for data in alliance %} { x: new Date({{data.time.year}}, {{data.time.month}}-1, {{data.time.day}}), y: {{data.points}} }, {% endfor %}],
                            label: '{{alliance.0.alliance.tag}}',
                            labels: [{% for data in alliance %} '{{alliance.0.alliance.tag}} {{data.points}} {{data.members}}', {% endfor %}],
                            lineTension: 0.3,
                            pointRadius: 3,
                            pointBorderColor: colors[{{forloop.counter}} % colors.length],
                            backgroundColor: backgroundColors[{{forloop.counter}} % backgroundColors.length],
                            borderColor: colors[{{forloop.counter}} % colors.length]
                        },
                        {% endfor %}
                    ],
                  },
                  options: {
                    responsive: true,
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                var dataset = data.datasets[tooltipItem.datasetIndex];
                                var index = tooltipItem.index;
                                return dataset.labels[index];
                            }
                        }
                    },
                    plugins: {
                      legend: {
                        position: 'top',
                      },
                      title: {
                        display: true,
                        text: 'Chart.js Line Chart'
                      }
                    },
                  scales: {
                    xAxes: [{
                      type: 'time',
                      autoSkip: false
                    }],
                    yAxes: {
                      type: 'number',
                      autoSkip: false
                    },
                  }

                  },
             };
            var ctx = document.getElementById('alliances_chart').getContext('2d');
             window.alliances_chart = new Chart(ctx, alliances_config);
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    {% load helper_extras %}
{% endblock %}

{% block content %}
    {% load widget_tweaks %}
{% include "helper/navigation.html" %}

<div class="tile" style="max-width: 1000px;">
    <div class="row center">
        <h3>Sojusze</h3>
    </div>

    <hr>
    <canvas id="alliances_chart"></canvas>
    <form action="{% url 'helper:save_alliances_statistics' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{user.id}}">
        <button class="btn btn-success">Zapisz statystyki</button>
    </form>
</div>

{% endblock %}